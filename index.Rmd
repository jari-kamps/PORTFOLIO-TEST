---
title: "Storyboard Jari Kamps"
output: 
  flexdashboard::flex_dashboard:
    storyboard: true
---

Homework Week 12 {.storyboard}
=========================================

### Corpus
For this weeks homework I made a dendogram based on all the individual tracks from the corpus to see how the tracks from all the different albums relate to each other. 

```{r}
```

### Dendogram

```{r}
library(tidyverse)
library(tidymodels)
library(ggdendro)
library(heatmaply)
library(spotifyr)
library(compmus)

get_conf_mat <- function(fit) {
  outcome <- .get_tune_outcome_names(fit)
  fit |> 
    collect_predictions() |> 
    conf_mat(truth = outcome, estimate = .pred_class)
}  

get_pr <- function(fit) {
  fit |> 
    conf_mat_resampled() |> 
    group_by(Prediction) |> mutate(precision = Freq / sum(Freq)) |> 
    group_by(Truth) |> mutate(recall = Freq / sum(Freq)) |> 
    ungroup() |> filter(Prediction == Truth) |> 
    select(class = Prediction, precision, recall)
}  

sevnalbums <-
  get_playlist_audio_features("jnk", "36UKFGHMewsc9n8KIspNrB") |>
  add_audio_analysis() |>
  mutate(
    segments = map2(segments, key, compmus_c_transpose),
    pitches =
      map(segments,
          compmus_summarise, pitches,
          method = "mean", norm = "manhattan"
      ),
    timbre =
      map(
        segments,
        compmus_summarise, timbre,
        method = "mean"
      )
  ) |>
  mutate(pitches = map(pitches, compmus_normalise, "clr")) |>
  mutate_at(vars(pitches, timbre), map, bind_rows) |>
  unnest(cols = c(pitches, timbre))

sevnalbums_juice <-
  recipe(
    track.name ~
      danceability +
      energy +
      loudness +
      speechiness +
      acousticness +
      instrumentalness +
      liveness +
      valence +
      tempo +
      duration +
      C + `C#|Db` + D + `D#|Eb` +
      E + `F` + `F#|Gb` + G +
      `G#|Ab` + A + `A#|Bb` + B +
      c01 + c02 + c03 + c04 + c05 + c06 +
      c07 + c08 + c09 + c10 + c11 + c12,
    data = sevnalbums
  ) |>
  step_center(all_predictors()) |>
  step_scale(all_predictors()) |> 
  # step_range(all_predictors()) |> 
  prep(sevnalbums |> mutate(track.name = str_trunc(track.name, 20))) |>
  juice() |>
  column_to_rownames("track.name")

sevnalbums_dist <- dist(sevnalbums_juice, method = "euclidean")

sevnalbums_dist |> 
  hclust(method = "single") |> # Try single, average, and complete.
  dendro_data() |>
  ggdendrogram()

```

Homework Week 11 {.storyboard}
=========================================

### Tempograms
For this weeks homework I made two tempograms based on two outliers from the corpus. I compared the tracks with the highest and lowest bpm and made both tempograms. The track from the corpus with the lowest bpm is Mileage with a 61.778 bpm, the highest is Middle with 199.928 bpm. PS I have some major technical difficulties with the loading and knitting of my tempograms. 

```{r}
```

### Mileage

```{r}
library(tidyverse)
library(spotifyr)
library(compmus)

Mileage <-
  get_tidy_audio_analysis("4tOoKxtiLr1qH2AHUI5KqU") |>
  select(segments) |>
  unnest(segments)

Mileage |>
  mutate(loudness_max_time = start + loudness_max_time) |>
  arrange(loudness_max_time) |>
  mutate(delta_loudness = loudness_max - lag(loudness_max)) |>
  ggplot(aes(x = loudness_max_time, y = pmax(0, delta_loudness))) +
  geom_line() +
  xlim(0, 30) +
  theme_minimal() +
  labs(x = "Time (s)", y = "Novelty")

```

### Middle

```{r}
library(tidyverse)
library(spotifyr)
library(compmus)

Middle <-
  get_tidy_audio_analysis("0JFkkqgv6r2SpbEAj7q5rt") |>
  select(segments) |>
  unnest(segments)

Middle |>
  mutate(loudness_max_time = start + loudness_max_time) |>
  arrange(loudness_max_time) |>
  mutate(delta_loudness = loudness_max - lag(loudness_max)) |>
  ggplot(aes(x = loudness_max_time, y = pmax(0, delta_loudness))) +
  geom_line() +
  xlim(0, 30) +
  theme_minimal() +
  labs(x = "Time (s)", y = "Novelty")

```

Introduction {.storyboard}
=========================================

### Introduction to corpus

```{r}
```

### Frame 2
Hier kan je je tekst zetten.

```{r}
```

Graphs {.storyboard}
=========================================

### Frame 3

```{r}
```

### Frame 4

```{r}
```

Column
-----------------------------------------