---
title: "The commercial success of solo albums by Sevn Alias. Made by Jari Kamps"
output: 
  flexdashboard::flex_dashboard:
    storyboard: true
---

Introduction {.storyboard}
=========================================

### INTRODUCTION TO THE CORPUS
First of all, a brief description of my corpus to start with an introduction to my portfolio of computational musicology. I chose for one of the biggest Dutch Hip Hop artists of the past decade, Sevn Alias, as the main focus of my corpus, with the possible related questions: ‘’Which Sevn Alias albums were the most commercially successful and does this commercial success correspond in any way to the label where the artist was at the time signed at?’’. I chose this corpus of all his solo-albums because Sevn Alias was one of the artists who started popping up at the beginning of the rise of the influence of hip hop in the Dutch music scene, and he is considered to be one of the biggest and most influential. The main interesting part of it is, in my opinion, the fact that he released over 10 albums in the past decade, all with major success and under different labels in each of the release periods. The natural groups and points of comparison in the corpus are mainly focussed on the artist Sevn Alias his solo albums, the music labels who distributed the albums and the amounts of streams of each track from every album. I think these groups are most relatable on the point that it is the same artist on every track and differ the most on the producers behind the tracks and possible featuring’s on the tracks. Although, these can also be the main points that I’m still a bit uncertain about, because they also have an influence on the outcome of each track and therefore, the possible commercial success. I created my own Spotify-playlist with all available tracks from every solo-album of Sevn Alias available on solely Spotify. The following link leads to the public playlist I created: https://open.spotify.com/playlist/36UKFGHMewsc9n8KIspNrB?si=bdfe0cdf208347fb

```{r}
```

First impressions {.storyboard}
=========================================

### FIRST IMPRESSIONS
For the homework assignment of week 7, I chose to create several ggplots, since I think that three track 'features' are the support for my topic. In this case the danceability, energy and track popularity API features. I think the track features danceability and energy could play an important factor in terms of commercial success, because I think these factors are important for things like the extent to which it is played in public spheres. A higher danceability and energy level could perhaps support the definition of commercial success per album. The track popularity (number between 0 and 100) represents the overall popularity of the song by album, with a number closer to 100 being Sevn Alias most popular song. As a result, I find it interesting that energy and danceability are somewhat different in comparison, especially in the releases between 2018 and 2019, where a higher degree of danceability relates to a lower energy. It is also interesting that the general track popularity of the songs has a relatively general point per album, despite huge hits, 'outliers', in for example the year 2018. Around 2021, the album has a broader spread in terms of general popularity. I found these aspects interesting.

```{r}
```

### VISUALISATION TRACK POPULARITY

```{r}
library(tufte)
library(spotifyr)
library(tidyverse)
library(ggplot2)
library(dplyr)

sevn <- get_playlist_audio_features("", "36UKFGHMewsc9n8KIspNrB")

ggplot(sevn, aes(y = track.popularity, x = as.Date(track.album.release_date))) +
  geom_point() +
  geom_smooth() +
  xlim(as.Date("2016-01-15"), as.Date("2022-12-09")) +
  labs(x = "Release Date", y = "Track Popularity", title = "TRACK POPULARITY LEVEL") +
  theme_light()

```

### VISUALISATION ENERGY

```{r}
library(tufte)
library(spotifyr)
library(tidyverse)
library(ggplot2)
library(dplyr)

sevn <- get_playlist_audio_features("", "36UKFGHMewsc9n8KIspNrB")

ggplot(sevn, aes(y = energy, x = as.Date(track.album.release_date))) +
  geom_point() +
  geom_smooth() +
  xlim(as.Date("2016-01-15"), as.Date("2022-12-09")) +
  labs(x = "Release Date", y = "Energy", title = "ENERGY LEVEL") +
  theme_light()

```

### VISUALISATION DANCEABILITY

```{r}
library(tufte)
library(spotifyr)
library(tidyverse)
library(ggplot2)
library(dplyr)

sevn <- get_playlist_audio_features("", "36UKFGHMewsc9n8KIspNrB")

ggplot(sevn, aes(y = danceability, x = as.Date(track.album.release_date))) +
  geom_point() +
  geom_smooth() +
  xlim(as.Date("2016-01-15"), as.Date("2022-12-09")) +
  labs(x = "Release Date", y = "Danceability", title = "DANCEABILITY LEVEL") +
  theme_light()

```

Noticeable outlier {.storyboard}
=========================================

### NOTICEABLE OUTLIERS
Layhoun, enige in E Major, extreem lage track popularity van 15. Centen, enige in B major, extreem lage track popularity van 14. beide van het album TwentyFourSevn 3.

```{r}
```

### VISUALISATION CHROMAGRAM LAYHOUN

```{r}
library(tidyverse)
library(spotifyr)
library(compmus)

layhoun <-
  get_tidy_audio_analysis("74ebZ2HIgo4NmTy9HMe0oN") |>
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches)

layhoun |>
  mutate(pitches = map(pitches, compmus_normalise, "euclidean")) |>
  compmus_gather_chroma() |> 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  theme_minimal() +
  scale_fill_viridis_c()

```

### VISUALISATION CHROMAGRAM CENTEN

```{r}
library(tidyverse)
library(spotifyr)
library(compmus)

centen <-
  get_tidy_audio_analysis("6cc3CUymJMeVrPUPsRjVad") |>
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches)

centen |>
  mutate(pitches = map(pitches, compmus_normalise, "euclidean")) |>
  compmus_gather_chroma() |> 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  theme_minimal() +
  scale_fill_viridis_c()

```

Timbre outlier {.storyboard}
=========================================

### TIMBRE OUTLIER
Als we een vergelijking maken in instrumentalness en klank kleur (timbre) zien we dat Ik Trap van het album OAKINN een outlier is met de meeste. de tweede meeste is Klim van het album SIRIUS, wat op zich ook een grote outlier vormt. beiden ongeveer evenveel danceability van gemiddeld 0.8, maar verschil in energy - ik trap met 0.7 en klim met 0.4. heeft bijdrage aan de klankkeur daarom timbre cepstogram en self-similarity op beide twee.

```{r}
```

### VISUALISATION INSTRUMENTALNESS

```{r}
library(tufte)
library(spotifyr)
library(tidyverse)
library(ggplot2)
library(dplyr)

sevn <- get_playlist_audio_features("", "36UKFGHMewsc9n8KIspNrB")

ggplot(sevn, aes(y = instrumentalness, x = as.Date(track.album.release_date))) +
  geom_point() +
  geom_smooth() +
  xlim(as.Date("2016-01-15"), as.Date("2022-12-09")) +
  labs(x = "Release Date", y = "Instrumentalness", title = "INSTRUMENTALNESS LEVEL") +
  theme_light()

```

### VISUALISATION IK TRAP CEPSTOGRAM

```{r}
library(tidyverse)
library(spotifyr)
library(compmus)

iktrap <-
  get_tidy_audio_analysis("0unMc21fkiIASp7FjgWJ9Z") |> # Change URI.
  compmus_align(bars, segments) |>                     # Change `bars`
  select(bars) |>                                      #   in all three
  unnest(bars) |>                                      #   of these lines.
  mutate(
    pitches =
      map(segments,
          compmus_summarise, pitches,
          method = "rms", norm = "euclidean"              # Change summary & norm.
      )
  ) |>
  mutate(
    timbre =
      map(segments,
          compmus_summarise, timbre,
          method = "rms", norm = "euclidean"              # Change summary & norm.
      )
  )

iktrap |>
  compmus_gather_timbre() |>
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = basis,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  scale_fill_viridis_c() +                              
  theme_classic()

```

### VISUALISATION IK TRAP SELF-SIMILARITY MATRIX

```{r}
library(tidyverse)
library(spotifyr)
library(compmus)

iktrap <-
  get_tidy_audio_analysis("0unMc21fkiIASp7FjgWJ9Z") |> # Change URI.
  compmus_align(bars, segments) |>                     # Change `bars`
  select(bars) |>                                      #   in all three
  unnest(bars) |>                                      #   of these lines.
  mutate(
    pitches =
      map(segments,
          compmus_summarise, pitches,
          method = "rms", norm = "euclidean"              # Change summary & norm.
      )
  ) |>
  mutate(
    timbre =
      map(segments,
          compmus_summarise, timbre,
          method = "rms", norm = "euclidean"              # Change summary & norm.
      )
  )

iktrap |>
  compmus_self_similarity(timbre, "cosine") |> 
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_fixed() +
  scale_fill_viridis_c(guide = "none") +
  theme_classic() +
  labs(x = "", y = "")

```

### VISUALISATION KLIM CEPSTOGRAM

```{r}
library(tidyverse)
library(spotifyr)
library(compmus)

klim <-
  get_tidy_audio_analysis("5WZTHLjL4kz8rdBJzGtVpP") |> # Change URI.
  compmus_align(bars, segments) |>                     # Change `bars`
  select(bars) |>                                      #   in all three
  unnest(bars) |>                                      #   of these lines.
  mutate(
    pitches =
      map(segments,
          compmus_summarise, pitches,
          method = "rms", norm = "euclidean"              # Change summary & norm.
      )
  ) |>
  mutate(
    timbre =
      map(segments,
          compmus_summarise, timbre,
          method = "rms", norm = "euclidean"              # Change summary & norm.
      )
  )

klim |>
  compmus_gather_timbre() |>
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = basis,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  scale_fill_viridis_c() +                              
  theme_classic()

```

### VISUALISATION KLIM SELF-SIMILARITY MATRIX

```{r}
library(tidyverse)
library(spotifyr)
library(compmus)

klim <-
  get_tidy_audio_analysis("5WZTHLjL4kz8rdBJzGtVpP") |> # Change URI.
  compmus_align(bars, segments) |>                     # Change `bars`
  select(bars) |>                                      #   in all three
  unnest(bars) |>                                      #   of these lines.
  mutate(
    pitches =
      map(segments,
          compmus_summarise, pitches,
          method = "rms", norm = "euclidean"              # Change summary & norm.
      )
  ) |>
  mutate(
    timbre =
      map(segments,
          compmus_summarise, timbre,
          method = "rms", norm = "euclidean"              # Change summary & norm.
      )
  )

klim |>
  compmus_self_similarity(timbre, "cosine") |> 
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_fixed() +
  scale_fill_viridis_c(guide = "none") +
  theme_classic() +
  labs(x = "", y = "")

```

Homework Week 11 {.storyboard}
=========================================

### Tempograms
For this weeks homework I made two tempograms based on two outliers from the corpus. I compared the tracks with the highest and lowest bpm and made both tempograms. The track from the corpus with the lowest bpm is Mileage with a 61.778 bpm, the highest is Middle with 199.928 bpm. PS I have some major technical difficulties with the loading and knitting of my tempograms. 

```{r}
```

### Mileage

```{r}
library(tidyverse)
library(spotifyr)
library(compmus)

Mileage <-
  get_tidy_audio_analysis("4tOoKxtiLr1qH2AHUI5KqU") |>
  select(segments) |>
  unnest(segments)

Mileage |>
  mutate(loudness_max_time = start + loudness_max_time) |>
  arrange(loudness_max_time) |>
  mutate(delta_loudness = loudness_max - lag(loudness_max)) |>
  ggplot(aes(x = loudness_max_time, y = pmax(0, delta_loudness))) +
  geom_line() +
  xlim(0, 30) +
  theme_minimal() +
  labs(x = "Time (s)", y = "Novelty")

```

### Middle

```{r}
library(tidyverse)
library(spotifyr)
library(compmus)

Middle <-
  get_tidy_audio_analysis("0JFkkqgv6r2SpbEAj7q5rt") |>
  select(segments) |>
  unnest(segments)

Middle |>
  mutate(loudness_max_time = start + loudness_max_time) |>
  arrange(loudness_max_time) |>
  mutate(delta_loudness = loudness_max - lag(loudness_max)) |>
  ggplot(aes(x = loudness_max_time, y = pmax(0, delta_loudness))) +
  geom_line() +
  xlim(0, 30) +
  theme_minimal() +
  labs(x = "Time (s)", y = "Novelty")

```

Homework Week 12 {.storyboard}
=========================================

### Corpus
For this weeks homework I made a dendogram based on all the individual tracks from the corpus to see how the tracks from all the different albums relate to each other. 

```{r}
```

### Dendogram

```{r}
library(tidyverse)
library(tidymodels)
library(ggdendro)
library(heatmaply)
library(spotifyr)
library(compmus)

get_conf_mat <- function(fit) {
  outcome <- .get_tune_outcome_names(fit)
  fit |> 
    collect_predictions() |> 
    conf_mat(truth = outcome, estimate = .pred_class)
}  

get_pr <- function(fit) {
  fit |> 
    conf_mat_resampled() |> 
    group_by(Prediction) |> mutate(precision = Freq / sum(Freq)) |> 
    group_by(Truth) |> mutate(recall = Freq / sum(Freq)) |> 
    ungroup() |> filter(Prediction == Truth) |> 
    select(class = Prediction, precision, recall)
}  

sevnalbums <-
  get_playlist_audio_features("jnk", "36UKFGHMewsc9n8KIspNrB") |>
  add_audio_analysis() |>
  mutate(
    segments = map2(segments, key, compmus_c_transpose),
    pitches =
      map(segments,
          compmus_summarise, pitches,
          method = "mean", norm = "manhattan"
      ),
    timbre =
      map(
        segments,
        compmus_summarise, timbre,
        method = "mean"
      )
  ) |>
  mutate(pitches = map(pitches, compmus_normalise, "clr")) |>
  mutate_at(vars(pitches, timbre), map, bind_rows) |>
  unnest(cols = c(pitches, timbre))

sevnalbums_juice <-
  recipe(
    track.name ~
      danceability +
      energy +
      loudness +
      speechiness +
      acousticness +
      instrumentalness +
      liveness +
      valence +
      tempo +
      duration +
      C + `C#|Db` + D + `D#|Eb` +
      E + `F` + `F#|Gb` + G +
      `G#|Ab` + A + `A#|Bb` + B +
      c01 + c02 + c03 + c04 + c05 + c06 +
      c07 + c08 + c09 + c10 + c11 + c12,
    data = sevnalbums
  ) |>
  step_center(all_predictors()) |>
  step_scale(all_predictors()) |> 
  # step_range(all_predictors()) |> 
  prep(sevnalbums |> mutate(track.name = str_trunc(track.name, 20))) |>
  juice() |>
  column_to_rownames("track.name")

sevnalbums_dist <- dist(sevnalbums_juice, method = "euclidean")

sevnalbums_dist |> 
  hclust(method = "single") |> # Try single, average, and complete.
  dendro_data() |>
  ggdendrogram()

```

Conclusion {.storyboard}
=========================================

### CONCLUSION OF MY RESEARCH

```{r}
```
